let players,searchResults,playersData="assets/data/data.json";const pageContainer=document.querySelector("main"),playersContainer=document.querySelector(".players"),displayContainer=document.querySelector(".display"),searchBar=document.querySelector("#search"),searchToggle=document.querySelector("a.search"),displayText=displayContainer.querySelector("h1"),displayBG=displayContainer.querySelector(".image"),displayImage=displayContainer.querySelector("img"),displayControl=displayContainer.querySelectorAll("a.control"),displayKits=displayContainer.querySelector(".kits"),displayCount=displayContainer.querySelector(".count"),isVowel=function(t){return letter=t.charAt(0),"a"==letter||"e"==letter||"i"==letter||"o"==letter||"u"==letter?playerArticle="an":playerArticle="a",playerArticle+" "+t},listItems=function(t){let e="",s=0,a=t.length-2;return t.forEach((function(t){s==a?e=e+t+" and ":s>a?e+=t:e=e+t+", ",s+=1})),e},hasSponsor=function(t){return 0==t?"":` sponsored by ${t}`},isCaptain=function(t){return 0==t[0].captain?"playing for":"captaining"},displayMultipleKits=function(t){if(displayKits.innerHTML="",t.kit.length>1){let e=0;t.kit.forEach((function(s){const a=document.createElement("a");let i=null;if(0==e)i=playersContainer.querySelector(`[data-id="${t.id}"] img`).getAttribute("data-title1"),a.classList.add("current"),a.setAttribute("data-img",`url(assets/img/players/0${t.id}.svg)`);else{let s=`url(assets/img/players/0${t.id}.svg)`.replace(".svg",`-${e+1}.svg`);i=playersContainer.querySelector(`[data-id="${t.id}"] img`).getAttribute(`data-title${e+1}`),a.setAttribute("data-img",s)}a.classList.add("kit-switch"),a.setAttribute("data-kit",`filter_${e+=1}`),a.setAttribute("data-title",i),displayKits.appendChild(a)}))}},navigationEnd=function(t,e){displayControl[1].classList.remove("disabled"),displayControl[2].classList.remove("disabled"),0==t&&displayControl[2].classList.add("disabled"),t>=e-1&&displayControl[1].classList.add("disabled")},fillDisplay=function(t){let e=playersContainer.querySelector(`[data-id="${t}"]`),s=e.getAttribute("data-id"),a=e.getAttribute("title"),i=e.querySelector("img").getAttribute("data-title1"),l=s,r=players.length,n=s-1;e.classList.contains("searched")&&(r=searchResults.length,searchResults.forEach((function(t,s){t.dataset.id==e.dataset.id&&(l=s+1,n=l-1)}))),displayText.style.opacity=0,displayImage.style.opacity=0,setTimeout(()=>{displayText.innerHTML=a,displayImage.style.backgroundImage=`url(assets/img/players/0${s}.svg)`,displayImage.setAttribute("title",i),displayImage.setAttribute("data-id",s),displayText.style.opacity=1,displayImage.style.opacity=1},300),displayBG.classList.remove(displayBG.classList[1]),displayBG.classList.add(e.classList[1]),displayCount.innerHTML=`${l}/${r}`,displayKits.innerHTML="",zoomOut(),navigationEnd(n,r),displayMultipleKits(players[s-1])},toggleDisplay=function(){displayContainer.classList.contains("active")?(displayContainer.classList.remove("active"),displayKits.classList.remove("active"),displayControl[0].classList.remove("active"),displayControl[1].classList.remove("active"),displayControl[2].classList.remove("active"),displayCount.classList.remove("active"),displayImage.classList="",displayText.classList="",displayText.style.opacity=0,displayImage.style.opacity=0,searchBar.classList.contains("searching")&&searchBar.focus(),zoomOut()):(displayContainer.classList.add("active"),displayKits.classList.add("active"),displayControl[0].classList.add("active"),displayControl[1].classList.add("active"),displayControl[2].classList.add("active"),displayImage.classList.add("active"),displayText.classList.add("active"),displayCount.classList.add("active"))},toggleSearch=function(){playersContainer.classList.toggle("searching"),searchBar.classList.toggle("searching"),searchToggle.classList.toggle("searching"),searchBar.value="",searchPlayers(searchBar.value),searchBar.classList.contains("searching")?searchBar.focus():searchBar.blur()},searchPlayers=function(t){searchResults=[];let e=t.toLowerCase(),s=playersContainer.querySelectorAll(".player");window.scrollTo(0,0),s.forEach((function(t){let s=t.getAttribute("data-tags").toLowerCase(),a="^(?=.*\\b"+e.trim().split(/\s+/).join("\\b)(?=.*\\b")+").*$",i=RegExp(a,"i");s.match(i)?(t.style.display="block",t.classList.add("searched"),searchResults.push(t)):(t.style.display="none",t.classList.remove("searched"))}))},findPlayer=function(t,e){let s=playersContainer.querySelectorAll(".player");if(1==t)for(let t=e+1;t<s.length;t++)if(s[t].classList.contains("searched"))return s[t].dataset.id;if(2==t)for(let t=e-1;t>=0;t--)if(s[t].classList.contains("searched"))return s[t].dataset.id},zoomOut=function(){displayImage.style.backgroundSize="150%",displayImage.style.backgroundPosition="50% 50%",displayBG.classList.remove("zoomed")};fetch(playersData).then(t=>t.json()).then(t=>{setTimeout(()=>pageContainer.classList.remove("loading"),2e3),players=t.players,players.forEach(t=>{let e,s=t,a=s.kit,i=s.competition,l=s.id;s.position.charAt(0);const r=document.createElement("div"),n=document.createElement("img");if(a.length>1){let t=0;r.setAttribute("data-multipleKits","yes"),a.forEach(a=>{t+=1,pColours=null,pColours=listItems(a.colours),n.setAttribute(`data-title${t}`,`${s.name} wearing ${isVowel(pColours)} ${a.brand} kit${hasSponsor(a.sponsor)}.`),str=a.colours.toString().replace(/,/g," "),e+=" "+str}),n.setAttribute("title",`${s.name} wearing ${isVowel(pColours)} ${listItems(a[0].colours)} ${a[0].brand} kit${hasSponsor(a[0].sponsor)}.`)}else r.setAttribute("data-multipleKits","no"),pColours=listItems(a[0].colours),n.setAttribute("data-title1",`${s.name} wearing ${isVowel(pColours)} ${a[0].brand} kit${hasSponsor(a[0].sponsor)}.`),n.setAttribute("title",`${s.name} wearing ${isVowel(pColours)} ${a[0].brand} kit${hasSponsor(a[0].sponsor)}.`),e=pColours.replace(" and",""),e=e.replace(",","");r.classList.add("player",`card-bg-${s.class}`,`tc-${s.class}`),0==a[0].sponsor&&(a[0].sponsor=""),r.setAttribute("data-id",s.id),r.setAttribute("data-name",s.name),r.setAttribute("data-collection",s.collection),r.setAttribute("data-tags",`${s.name} ${s.number} ${s.team} ${s.position} ${i.year} ${i.location} ${i.title} ${s.nationality} ${s.tags} ${s.collection} ${e} ${a[0].sponsor} ${a[0].brand}`),r.setAttribute("title",`${s.name} ${isCaptain(s.kit)} ${s.team} as ${isVowel(s.position)} in the ${i.year} ${i.location} ${i.title}.`),n.setAttribute("src","assets/img/blank.png"),n.setAttribute("alt",s.name),n.style.backgroundImage=`url(assets/img/players/0${l}.svg)`,r.appendChild(n),playersContainer.appendChild(r)})}).catch(t=>{pageContainer.classList.add("error")}),document.addEventListener("click",(function(t){if(t.target&&t.target.classList.contains("player")&&(toggleDisplay(),fillDisplay(t.target.dataset.id)),t.target&&t.target.classList.contains("kit-switch")){displayImage.style.backgroundImage;if(!t.target.classList.contains("current")){displayKits.querySelectorAll(".current").forEach(t=>{t.classList.remove("current")}),t.target.classList.add("current"),displayImage.style.backgroundImage=t.target.getAttribute("data-img"),displayImage.setAttribute("title",t.target.getAttribute("data-title"))}}})),displayControl.forEach(t=>{t.addEventListener("click",()=>{let e=parseInt(displayImage.getAttribute("data-id"));if(t.classList.contains("close")&&toggleDisplay(),t.classList.contains("next")){let s=e+1;playersContainer.classList.contains("searching")&&(s=findPlayer(1,s)),t.classList.contains("disabled")||fillDisplay(s)}if(t.classList.contains("previous")){let s=e-1;playersContainer.classList.contains("searching")&&(s=findPlayer(2,s)),t.classList.contains("disabled")||fillDisplay(s)}})}),document.addEventListener("keyup",t=>{if(displayContainer.classList.contains("active")){let e=Math.floor(Math.random()*players.length),s=parseInt(displayImage.getAttribute("data-id"));if("Escape"==t.key&&toggleDisplay(),"r"==t.key&&(playersContainer.classList.contains("searching")||fillDisplay(0==e?1:e)),"ArrowRight"==t.key){let t=s+1;playersContainer.classList.contains("searching")&&(t=findPlayer(1,t)),displayControl[1].classList.contains("disabled")||fillDisplay(t)}if("ArrowLeft"==t.key){let t=s-1;playersContainer.classList.contains("searching")&&(t=findPlayer(2,t)),displayControl[2].classList.contains("disabled")||fillDisplay(t)}}else searchBar.classList.contains("searching")?"Escape"==t.key&&toggleSearch():"s"==t.key&&toggleSearch()}),displayBG.addEventListener("click",()=>{displayBG.classList.contains("zoomed")?zoomOut():(displayImage.style.backgroundSize="600%",displayBG.classList.add("zoomed"))}),displayBG.addEventListener("mousemove",t=>{if(displayBG.classList.contains("zoomed")){let e=-t.offsetX-1150,s=-t.offsetY-1e3;displayImage.style.backgroundPosition=`${e}px ${s}px`}}),searchToggle.addEventListener("click",()=>{toggleSearch()}),searchBar.addEventListener("keyup",()=>{searchPlayers(searchBar.value)});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicGxheWVycyIsInNlYXJjaFJlc3VsdHMiLCJwbGF5ZXJzRGF0YSIsInBhZ2VDb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJwbGF5ZXJzQ29udGFpbmVyIiwiZGlzcGxheUNvbnRhaW5lciIsInNlYXJjaEJhciIsInNlYXJjaFRvZ2dsZSIsImRpc3BsYXlUZXh0IiwiZGlzcGxheUJHIiwiZGlzcGxheUltYWdlIiwiZGlzcGxheUNvbnRyb2wiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZGlzcGxheUtpdHMiLCJkaXNwbGF5Q291bnQiLCJpc1Zvd2VsIiwic3RyIiwibGV0dGVyIiwiY2hhckF0IiwicGxheWVyQXJ0aWNsZSIsImxpc3RJdGVtcyIsIml0ZW1zIiwic3RyaW5nIiwiY291bnQiLCJsZW5ndGgiLCJmb3JFYWNoIiwiaXRlbSIsImhhc1Nwb25zb3IiLCJraXQiLCJpc0NhcHRhaW4iLCJwbGF5ZXIiLCJjYXB0YWluIiwiZGlzcGxheU11bHRpcGxlS2l0cyIsImlubmVySFRNTCIsImsiLCJraXRMaW5rIiwiY3JlYXRlRWxlbWVudCIsInRpdGxlIiwiaWQiLCJnZXRBdHRyaWJ1dGUiLCJjbGFzc0xpc3QiLCJhZGQiLCJzZXRBdHRyaWJ1dGUiLCJuZXh0S2l0IiwicmVwbGFjZSIsImFwcGVuZENoaWxkIiwibmF2aWdhdGlvbkVuZCIsIngiLCJyZW1vdmUiLCJmaWxsRGlzcGxheSIsInBJZCIsInBUZXh0IiwicFRpdGxlIiwicENvdW50IiwicExlbmd0aCIsInBOZXh0IiwiY29udGFpbnMiLCJyZXN1bHQiLCJpIiwiZGF0YXNldCIsInN0eWxlIiwib3BhY2l0eSIsInNldFRpbWVvdXQiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJ6b29tT3V0IiwidG9nZ2xlRGlzcGxheSIsImZvY3VzIiwidG9nZ2xlU2VhcmNoIiwidG9nZ2xlIiwidmFsdWUiLCJzZWFyY2hQbGF5ZXJzIiwiYmx1ciIsInRvTG93ZXJDYXNlIiwicGxheWVyTGlzdCIsIndpbmRvdyIsInNjcm9sbFRvIiwidGFncyIsInJlZ0V4cCIsInRyaW0iLCJzcGxpdCIsImpvaW4iLCJSZWdFeHAiLCJtYXRjaCIsImRpc3BsYXkiLCJwdXNoIiwiZmluZFBsYXllciIsImRpcmVjdGlvbiIsImJhY2tncm91bmRTaXplIiwiYmFja2dyb3VuZFBvc2l0aW9uIiwiZmV0Y2giLCJ0aGVuIiwicmVzcG9uc2UiLCJqc29uIiwiZGF0YSIsImNUYWdzIiwicCIsImMiLCJjb21wZXRpdGlvbiIsInN2ZyIsInBvc2l0aW9uIiwiZGl2IiwiaW1nIiwicENvbG91cnMiLCJjb2xvdXJzIiwibmFtZSIsImJyYW5kIiwic3BvbnNvciIsInRvU3RyaW5nIiwiY2xhc3MiLCJjb2xsZWN0aW9uIiwibnVtYmVyIiwidGVhbSIsInllYXIiLCJsb2NhdGlvbiIsIm5hdGlvbmFsaXR5IiwiY2F0Y2giLCJyZWFzb24iLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsInRhcmdldCIsImJ0biIsImJ1dHRvbiIsImN1cnJlbnRQbGF5ZXIiLCJwYXJzZUludCIsIm5leHRQbGF5ZXIiLCJwcmV2UGxheWVyIiwicmFuZG9tUGxheWVyIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwia2V5Iiwib2Zmc2V0WCIsInkiLCJvZmZzZXRZIl0sIm1hcHBpbmdzIjoiQUFFQSxJQUVJQSxRQUNBQyxjQUhBQyxZQUFzQix3QkFLMUIsTUFBTUMsY0FBb0JDLFNBQVNDLGNBQWMsUUFDM0NDLGlCQUFvQkYsU0FBU0MsY0FBYyxZQUMzQ0UsaUJBQW9CSCxTQUFTQyxjQUFjLFlBQzNDRyxVQUFvQkosU0FBU0MsY0FBYyxXQUMzQ0ksYUFBb0JMLFNBQVNDLGNBQWMsWUFFM0NLLFlBQW9CSCxpQkFBaUJGLGNBQWMsTUFDbkRNLFVBQW9CSixpQkFBaUJGLGNBQWMsVUFDbkRPLGFBQW9CTCxpQkFBaUJGLGNBQWMsT0FDbkRRLGVBQW9CTixpQkFBaUJPLGlCQUFpQixhQUN0REMsWUFBb0JSLGlCQUFpQkYsY0FBYyxTQUNuRFcsYUFB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QWNoRSxVQUFVK0QiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFNldCBtYWluIHZhcmlhYmxlc1xuXG5sZXQgcGxheWVyc0RhdGEgICAgICAgICA9ICdhc3NldHMvZGF0YS9kYXRhLmpzb24nO1xuXG5sZXQgcGxheWVycztcbmxldCBzZWFyY2hSZXN1bHRzO1xuXG5jb25zdCBwYWdlQ29udGFpbmVyICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ21haW4nKTtcbmNvbnN0IHBsYXllcnNDb250YWluZXIgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllcnMnKTtcbmNvbnN0IGRpc3BsYXlDb250YWluZXIgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRpc3BsYXknKTtcbmNvbnN0IHNlYXJjaEJhciAgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NlYXJjaCcpO1xuY29uc3Qgc2VhcmNoVG9nZ2xlICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdhLnNlYXJjaCcpO1xuXG5jb25zdCBkaXNwbGF5VGV4dCAgICAgICA9IGRpc3BsYXlDb250YWluZXIucXVlcnlTZWxlY3RvcignaDEnKTtcbmNvbnN0IGRpc3BsYXlCRyAgICAgICAgID0gZGlzcGxheUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuaW1hZ2UnKTtcbmNvbnN0IGRpc3BsYXlJbWFnZSAgICAgID0gZGlzcGxheUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdpbWcnKTtcbmNvbnN0IGRpc3BsYXlDb250cm9sICAgID0gZGlzcGxheUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdhLmNvbnRyb2wnKTtcbmNvbnN0IGRpc3BsYXlLaXRzICAgICAgID0gZGlzcGxheUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcua2l0cycpO1xuY29uc3QgZGlzcGxheUNvdW50ICAgICAgPSBkaXNwbGF5Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5jb3VudCcpO1xuXG4vLyBGdW5jdGlvbnNcblxuLy8gSXMgdGhlIGZpcnN0IGxldHRlciBvZiBhIHN0cmluZyBhIHZvd2VsP1xuXG5jb25zdCBpc1Zvd2VsID0gZnVuY3Rpb24gKHN0cikge1xuXG4gICAgbGV0dGVyID0gc3RyLmNoYXJBdCgwKTtcblxuICAgIGlmIChsZXR0ZXIgPT0gJ2EnIHx8IGxldHRlciA9PSAnZScgfHwgbGV0dGVyID09ICdpJyB8fCBsZXR0ZXIgPT0gJ28nIHx8IGxldHRlciA9PSAndScpIHtcblxuICAgICAgICBwbGF5ZXJBcnRpY2xlID0gJ2FuJztcblxuICAgIH0gZWxzZSB7XG5cbiAgICAgICAgcGxheWVyQXJ0aWNsZSA9ICdhJztcblxuICAgIH1cblxuICAgIHJldHVybiBwbGF5ZXJBcnRpY2xlICsgJyAnICsgc3RyO1xuXG59XG5cbi8vIExpc3QgYWxsIGl0ZW1zIGluIGFuIGFycmF5IGFuZCBhZGQgXCJhbmRcIiBiZWZvcmUgdGhlIGxhc3QgaXRlbVxuXG5jb25zdCBsaXN0SXRlbXMgPSBmdW5jdGlvbiAoaXRlbXMpIHtcblxuICAgIGxldCBzdHJpbmcgID0gJyc7XG4gICAgbGV0IGNvdW50ICAgPSAwO1xuICAgIGxldCBsZW5ndGggID0gaXRlbXMubGVuZ3RoLTI7XG5cbiAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcblxuICAgICAgICBpZiAoY291bnQgPT0gbGVuZ3RoKSB7XG5cbiAgICAgICAgICAgIHN0cmluZyA9IHN0cmluZyArIGl0ZW0gKyAnIGFuZCAnO1xuXG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChjb3VudCA+IGxlbmd0aCkge1xuXG4gICAgICAgICAgICBzdHJpbmcgPSBzdHJpbmcgKyBpdGVtO1xuXG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIHtcblxuICAgICAgICAgICAgc3RyaW5nID0gc3RyaW5nICsgaXRlbSArICcsICc7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGNvdW50ID0gY291bnQgKyAxO1xuXG4gICAgfSk7XG5cbiAgICByZXR1cm4gc3RyaW5nO1xuXG59XG5cbi8vIElzIHRoZSBraXQgc3BvbnNvcmVkP1xuXG5jb25zdCBoYXNTcG9uc29yID0gZnVuY3Rpb24gKGtpdCkge1xuXG4gICAgaWYgKGtpdCA9PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGAgc3BvbnNvcmVkIGJ5ICR7a2l0fWA7XG4gICAgfVxuXG59XG5cbi8vIElzIHBsYXllciBhIGNhcHRhaW4/XG5cbmNvbnN0IGlzQ2FwdGFpbiA9IGZ1bmN0aW9uIChwbGF5ZXIpIHtcblxuICAgIGlmIChwbGF5ZXJbMF0uY2FwdGFpbiA9PSBmYWxzZSkge1xuXG4gICAgICAgIHJldHVybiAncGxheWluZyBmb3InO1xuXG4gICAgfSBlbHNlIHtcblxuICAgICAgICByZXR1cm4gJ2NhcHRhaW5pbmcnO1xuXG4gICAgfVxuXG59XG5cbi8vIERpc3BsYXkgbXVsdGlwbGUga2l0IHN3aXRjaGVyc1xuXG5jb25zdCBkaXNwbGF5TXVsdGlwbGVLaXRzID0gZnVuY3Rpb24gKHBsYXllcikge1xuXG4gICAgZGlzcGxheUtpdHMuaW5uZXJIVE1MID0gJyc7XG5cbiAgICBpZiAocGxheWVyLmtpdC5sZW5ndGggPiAxKSB7XG5cbiAgICAgICAgbGV0IGsgPSAwO1xuXG4gICAgICAgIHBsYXllci5raXQuZm9yRWFjaChmdW5jdGlvbihraXQpIHtcblxuICAgICAgICAgICAgY29uc3Qga2l0TGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcblxuICAgICAgICAgICAgbGV0IHRpdGxlID0gbnVsbDtcblxuICAgICAgICAgICAgaWYgKGsgPT0gMCkge1xuXG4gICAgICAgICAgICAgICAgdGl0bGUgPSBwbGF5ZXJzQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWlkPVwiJHtwbGF5ZXIuaWR9XCJdIGltZ2ApLmdldEF0dHJpYnV0ZSgnZGF0YS10aXRsZTEnKTtcblxuICAgICAgICAgICAgICAgIGtpdExpbmsuY2xhc3NMaXN0LmFkZCgnY3VycmVudCcpO1xuICAgICAgICAgICAgICAgIGtpdExpbmsuc2V0QXR0cmlidXRlKCdkYXRhLWltZycsYHVybChhc3NldHMvaW1nL3BsYXllcnMvMCR7cGxheWVyLmlkfS5zdmcpYCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBsZXQgYmFzZUtpdCAgICAgPSBgdXJsKGFzc2V0cy9pbWcvcGxheWVycy8wJHtwbGF5ZXIuaWR9LnN2ZylgO1xuICAgICAgICAgICAgICAgIGxldCBuZXh0S2l0ICAgICA9IGJhc2VLaXQucmVwbGFjZSgnLnN2ZycsYC0ke2srMX0uc3ZnYCk7XG5cbiAgICAgICAgICAgICAgICB0aXRsZSA9IHBsYXllcnNDb250YWluZXIucXVlcnlTZWxlY3RvcihgW2RhdGEtaWQ9XCIke3BsYXllci5pZH1cIl0gaW1nYCkuZ2V0QXR0cmlidXRlKGBkYXRhLXRpdGxlJHtrKzF9YCk7XG5cbiAgICAgICAgICAgICAgICBraXRMaW5rLnNldEF0dHJpYnV0ZSgnZGF0YS1pbWcnLG5leHRLaXQpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGtpdExpbmsuY2xhc3NMaXN0LmFkZCgna2l0LXN3aXRjaCcpO1xuICAgICAgICAgICAga2l0TGluay5zZXRBdHRyaWJ1dGUoJ2RhdGEta2l0JyxgZmlsdGVyXyR7ayA9IGsrMX1gKTtcbiAgICAgICAgICAgIGtpdExpbmsuc2V0QXR0cmlidXRlKCdkYXRhLXRpdGxlJywgdGl0bGUpO1xuXG4gICAgICAgICAgICBkaXNwbGF5S2l0cy5hcHBlbmRDaGlsZChraXRMaW5rKTtcblxuICAgICAgICB9KTtcblxuICAgIH1cblxufVxuXG4vLyBFbmQgb2YgbmF2aWdhdGlvblxuXG5jb25zdCBuYXZpZ2F0aW9uRW5kID0gZnVuY3Rpb24gKGlkLHgpIHtcblxuICAgIGRpc3BsYXlDb250cm9sWzFdLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7XG4gICAgZGlzcGxheUNvbnRyb2xbMl0uY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZWQnKTtcblxuICAgIGlmIChpZCA9PSAwKSB7XG5cbiAgICAgICAgZGlzcGxheUNvbnRyb2xbMl0uY2xhc3NMaXN0LmFkZCgnZGlzYWJsZWQnKTtcblxuICAgIH1cblxuICAgIGlmIChpZCA+PSB4LTEpIHtcblxuICAgICAgICBkaXNwbGF5Q29udHJvbFsxXS5jbGFzc0xpc3QuYWRkKCdkaXNhYmxlZCcpO1xuXG4gICAgfVxuXG59XG5cbi8vIEZpbGwgZGlzcGxheSB3aXRoIHBsYXllciBpbmZvXG5cbmNvbnN0IGZpbGxEaXNwbGF5ID0gZnVuY3Rpb24gKGlkKSB7XG5cbiAgICBsZXQgcGxheWVyICA9IHBsYXllcnNDb250YWluZXIucXVlcnlTZWxlY3RvcihgW2RhdGEtaWQ9XCIke2lkfVwiXWApO1xuXG4gICAgbGV0IHBJZCAgICAgPSBwbGF5ZXIuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7XG4gICAgbGV0IHBUZXh0ICAgPSBwbGF5ZXIuZ2V0QXR0cmlidXRlKCd0aXRsZScpO1xuICAgIGxldCBwSW1nICAgID0gcGxheWVyLnF1ZXJ5U2VsZWN0b3IoJ2ltZycpO1xuICAgIGxldCBwVGl0bGUgID0gcEltZy5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGl0bGUxJyk7XG4gICAgbGV0IHBDb3VudCAgPSBwSWQ7XG4gICAgbGV0IHBMZW5ndGggPSBwbGF5ZXJzLmxlbmd0aDtcbiAgICBsZXQgcE5leHQgICA9IHBJZC0xO1xuXG4gICAgaWYgKHBsYXllci5jbGFzc0xpc3QuY29udGFpbnMoJ3NlYXJjaGVkJykpIHtcblxuICAgICAgICBwTGVuZ3RoID0gc2VhcmNoUmVzdWx0cy5sZW5ndGg7XG5cbiAgICAgICAgc2VhcmNoUmVzdWx0cy5mb3JFYWNoKGZ1bmN0aW9uKHJlc3VsdCwgaSkge1xuXG4gICAgICAgICAgICBpZiAocmVzdWx0LmRhdGFzZXQuaWQgPT0gcGxheWVyLmRhdGFzZXQuaWQpIHtcblxuICAgICAgICAgICAgICAgIHBDb3VudCA9IGkrMTtcbiAgICAgICAgICAgICAgICBwTmV4dCAgPSBwQ291bnQtMTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgZGlzcGxheVRleHQuc3R5bGUub3BhY2l0eSAgID0gMDtcbiAgICBkaXNwbGF5SW1hZ2Uuc3R5bGUub3BhY2l0eSAgPSAwO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG5cbiAgICAgICAgZGlzcGxheVRleHQuaW5uZXJIVE1MID0gcFRleHQ7XG5cbiAgICAgICAgZGlzcGxheUltYWdlLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGB1cmwoYXNzZXRzL2ltZy9wbGF5ZXJzLzAke3BJZH0uc3ZnKWA7XG4gICAgICAgIGRpc3BsYXlJbWFnZS5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgcFRpdGxlKTtcbiAgICAgICAgZGlzcGxheUltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1pZCcsIHBJZCk7XG5cbiAgICAgICAgZGlzcGxheVRleHQuc3R5bGUub3BhY2l0eSAgID0gMTtcbiAgICAgICAgZGlzcGxheUltYWdlLnN0eWxlLm9wYWNpdHkgID0gMTtcblxuICAgIH0sIDMwMCk7XG5cbiAgICBkaXNwbGF5QkcuY2xhc3NMaXN0LnJlbW92ZShkaXNwbGF5QkcuY2xhc3NMaXN0WzFdKTtcbiAgICBkaXNwbGF5QkcuY2xhc3NMaXN0LmFkZChwbGF5ZXIuY2xhc3NMaXN0WzFdKTtcblxuICAgIGRpc3BsYXlDb3VudC5pbm5lckhUTUwgPSBgJHtwQ291bnR9LyR7cExlbmd0aH1gO1xuXG4gICAgZGlzcGxheUtpdHMuaW5uZXJIVE1MID0gJyc7XG5cbiAgICB6b29tT3V0KCk7XG4gICAgbmF2aWdhdGlvbkVuZChwTmV4dCwgcExlbmd0aCk7XG4gICAgZGlzcGxheU11bHRpcGxlS2l0cyhwbGF5ZXJzW3BJZC0xXSk7XG5cbn1cblxuLy8gVG9nZ2xlIGRpc3BsYXlcblxuY29uc3QgdG9nZ2xlRGlzcGxheSA9IGZ1bmN0aW9uICgpIHtcblxuICAgIGlmIChkaXNwbGF5Q29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykpIHtcblxuICAgICAgICBkaXNwbGF5Q29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgICAgICBkaXNwbGF5S2l0cy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgZGlzcGxheUNvbnRyb2xbMF0uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgIGRpc3BsYXlDb250cm9sWzFdLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgICAgICBkaXNwbGF5Q29udHJvbFsyXS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgZGlzcGxheUNvdW50LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuXG4gICAgICAgIGRpc3BsYXlJbWFnZS5jbGFzc0xpc3QgID0gJyc7XG4gICAgICAgIGRpc3BsYXlUZXh0LmNsYXNzTGlzdCAgID0gJyc7XG5cbiAgICAgICAgZGlzcGxheVRleHQuc3R5bGUub3BhY2l0eSAgID0gMDtcbiAgICAgICAgZGlzcGxheUltYWdlLnN0eWxlLm9wYWNpdHkgID0gMDtcblxuICAgICAgICBpZiAoc2VhcmNoQmFyLmNsYXNzTGlzdC5jb250YWlucygnc2VhcmNoaW5nJykpIHtcblxuICAgICAgICAgICAgc2VhcmNoQmFyLmZvY3VzKCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHpvb21PdXQoKTtcblxuICAgIH0gZWxzZSB7XG5cbiAgICAgICAgZGlzcGxheUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICAgZGlzcGxheUtpdHMuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgICAgIGRpc3BsYXlDb250cm9sWzBdLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgICAgICBkaXNwbGF5Q29udHJvbFsxXS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICAgZGlzcGxheUNvbnRyb2xbMl0uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgICAgIGRpc3BsYXlJbWFnZS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICAgZGlzcGxheVRleHQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgICAgIGRpc3BsYXlDb3VudC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcblxuICAgIH1cblxufVxuXG4vLyBUb2dnbGUgc2VhcmNoIGJhclxuXG5jb25zdCB0b2dnbGVTZWFyY2ggPSBmdW5jdGlvbiAoKSB7XG5cbiAgICBwbGF5ZXJzQ29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ3NlYXJjaGluZycpO1xuICAgIHNlYXJjaEJhci5jbGFzc0xpc3QudG9nZ2xlKCdzZWFyY2hpbmcnKTtcbiAgICBzZWFyY2hUb2dnbGUuY2xhc3NMaXN0LnRvZ2dsZSgnc2VhcmNoaW5nJyk7XG4gICAgc2VhcmNoQmFyLnZhbHVlID0gJyc7XG4gICAgc2VhcmNoUGxheWVycyhzZWFyY2hCYXIudmFsdWUpO1xuXG4gICAgaWYgKCFzZWFyY2hCYXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWFyY2hpbmcnKSkge1xuXG4gICAgICAgIHNlYXJjaEJhci5ibHVyKCk7XG5cbiAgICB9IGVsc2Uge1xuXG4gICAgICAgIHNlYXJjaEJhci5mb2N1cygpO1xuXG4gICAgfVxuXG59XG5cbi8vIFNlYXJjaCBwbGF5ZXJzXG5cbmNvbnN0IHNlYXJjaFBsYXllcnMgPSBmdW5jdGlvbiAoeCkge1xuXG4gICAgc2VhcmNoUmVzdWx0cyA9IFtdO1xuXG4gICAgbGV0IHZhbHVlICAgICAgID0geC50b0xvd2VyQ2FzZSgpO1xuICAgIGxldCBwbGF5ZXJMaXN0ICA9IHBsYXllcnNDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnBsYXllcicpO1xuXG4gICAgd2luZG93LnNjcm9sbFRvKDAsMCk7XG5cbiAgICBwbGF5ZXJMaXN0LmZvckVhY2goZnVuY3Rpb24ocGxheWVyKSB7XG5cbiAgICAgICAgbGV0IHRhZ3MgICAgICAgID0gcGxheWVyLmdldEF0dHJpYnV0ZSgnZGF0YS10YWdzJykudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgbGV0IHJlZ0V4cCAgICAgID0gJ14oPz0uKlxcXFxiJyArIHZhbHVlLnRyaW0oKS5zcGxpdCgvXFxzKy8pLmpvaW4oJ1xcXFxiKSg/PS4qXFxcXGInKSArICcpLiokJ1xuICAgICAgICBsZXQgcmVzdWx0ICAgICAgPSBSZWdFeHAocmVnRXhwLCAnaScpO1xuXG4gICAgICAgIGlmICh0YWdzLm1hdGNoKHJlc3VsdCkpIHtcblxuICAgICAgICAgICAgcGxheWVyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICAgICAgICBwbGF5ZXIuY2xhc3NMaXN0LmFkZCgnc2VhcmNoZWQnKTtcblxuICAgICAgICAgICAgc2VhcmNoUmVzdWx0cy5wdXNoKHBsYXllcik7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgcGxheWVyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgIHBsYXllci5jbGFzc0xpc3QucmVtb3ZlKCdzZWFyY2hlZCcpO1xuXG4gICAgICAgIH1cblxuICAgIH0pO1xuXG59XG5cbi8vIEZpbmQgcGxheWVyIGZyb20gc2VhcmNoIHJlc3VsdHNcblxuY29uc3QgZmluZFBsYXllciA9IGZ1bmN0aW9uIChkaXJlY3Rpb24sIGlkKSB7XG5cbiAgICBsZXQgcGxheWVyTGlzdCA9IHBsYXllcnNDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnBsYXllcicpO1xuXG4gICAgaWYgKGRpcmVjdGlvbiA9PSAxKSB7IC8vIG5leHRcblxuICAgICAgICBmb3IgKGxldCBpID0gaWQrMTsgaSA8IHBsYXllckxpc3QubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgaWYgKHBsYXllckxpc3RbaV0uY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWFyY2hlZCcpKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcGxheWVyTGlzdFtpXS5kYXRhc2V0LmlkO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgaWYgKGRpcmVjdGlvbiA9PSAyKSB7IC8vIHByZXZpb3VzXG5cbiAgICAgICAgZm9yIChsZXQgaSA9IGlkLTE7IGkgPj0gMDsgaS0tKSB7XG5cbiAgICAgICAgICAgIGlmIChwbGF5ZXJMaXN0W2ldLmNsYXNzTGlzdC5jb250YWlucygnc2VhcmNoZWQnKSkge1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBsYXllckxpc3RbaV0uZGF0YXNldC5pZDtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgIH1cblxufVxuXG4vLyBEaXNwbGF5IGltYWdlIHRvZ2dsZSB6b29tXG5cbmNvbnN0IHpvb21PdXQgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICBkaXNwbGF5SW1hZ2Uuc3R5bGUuYmFja2dyb3VuZFNpemUgPSAnMTUwJSc7XG4gICAgZGlzcGxheUltYWdlLnN0eWxlLmJhY2tncm91bmRQb3NpdGlvbiA9ICc1MCUgNTAlJztcblxuICAgIGRpc3BsYXlCRy5jbGFzc0xpc3QucmVtb3ZlKCd6b29tZWQnKTtcblxufVxuXG4vLyBHZXQgYW5kIGRpc3BsYXkgcGxheWVyc1xuXG5mZXRjaChwbGF5ZXJzRGF0YSlcbiAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXG4gICAgLnRoZW4oZGF0YSA9PiB7XG5cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBwYWdlQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRpbmcnKSwgMjAwMCk7XG5cbiAgICAgICAgcGxheWVycyA9IGRhdGEucGxheWVycztcblxuICAgICAgICBwbGF5ZXJzLmZvckVhY2gocGxheWVyID0+IHtcblxuICAgICAgICAgICAgLy8gUGxheWVyIGRhdGFcblxuICAgICAgICAgICAgbGV0IHAgICAgICAgICAgID0gcGxheWVyO1xuICAgICAgICAgICAgbGV0IGsgICAgICAgICAgID0gcC5raXQ7XG4gICAgICAgICAgICBsZXQgYyAgICAgICAgICAgPSBwLmNvbXBldGl0aW9uO1xuICAgICAgICAgICAgbGV0IHN2ZyAgICAgICAgID0gcC5pZDtcbiAgICAgICAgICAgIGxldCBwTGV0dGVyICAgICA9IHAucG9zaXRpb24uY2hhckF0KDApO1xuXG4gICAgICAgICAgICBsZXQgcFRhZ3M7XG4gICAgICAgICAgICBsZXQgY1RhZ3M7XG4gICAgICAgICAgICBsZXQgY2FwdGFpbjtcblxuICAgICAgICAgICAgLy8gQ3JlYXRlIHBsYXllciBjYXJkIGFuZCBpbWFnZVxuXG4gICAgICAgICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuXG4gICAgICAgICAgICAvLyBEb2VzIHRoaXMgcGxheWVyIGhhdmUgbXVsdGlwbGUga2l0cyBhbmQgYXJlIHRoZSBraXRzIHNwb25zb3JlZD9cblxuICAgICAgICAgICAgaWYgKGsubGVuZ3RoID4gMSkge1xuXG4gICAgICAgICAgICAgICAgbGV0IGNvdW50ID0gMDtcblxuICAgICAgICAgICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbXVsdGlwbGVLaXRzJywgJ3llcycpO1xuXG4gICAgICAgICAgICAgICAgay5mb3JFYWNoKGtpdCA9PiB7XG5cbiAgICAgICAgICAgICAgICAgICAgY291bnQgPSBjb3VudCArIDE7XG5cbiAgICAgICAgICAgICAgICAgICAgcENvbG91cnMgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBwQ29sb3VycyA9IGxpc3RJdGVtcyhraXQuY29sb3Vycyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaW1nLnNldEF0dHJpYnV0ZShgZGF0YS10aXRsZSR7Y291bnR9YCwgYCR7cC5uYW1lfSB3ZWFyaW5nICR7aXNWb3dlbChwQ29sb3Vycyl9ICR7a2l0LmJyYW5kfSBraXQke2hhc1Nwb25zb3Ioa2l0LnNwb25zb3IpfS5gKTtcblxuICAgICAgICAgICAgICAgICAgICBzdHIgPSBraXQuY29sb3Vycy50b1N0cmluZygpLnJlcGxhY2UoLywvZywnICcpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNUYWdzICs9ICcgJyArIHN0cjtcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaW1nLnNldEF0dHJpYnV0ZSgndGl0bGUnLCBgJHtwLm5hbWV9IHdlYXJpbmcgJHtpc1Zvd2VsKHBDb2xvdXJzKX0gJHtsaXN0SXRlbXMoa1swXS5jb2xvdXJzKX0gJHtrWzBdLmJyYW5kfSBraXQke2hhc1Nwb25zb3Ioa1swXS5zcG9uc29yKX0uYCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLW11bHRpcGxlS2l0cycsICdubycpO1xuXG4gICAgICAgICAgICAgICAgcENvbG91cnMgPSBsaXN0SXRlbXMoa1swXS5jb2xvdXJzKTtcblxuICAgICAgICAgICAgICAgIC8vIFNldCBpbWFnZSB0aXRsZVxuXG4gICAgICAgICAgICAgICAgaW1nLnNldEF0dHJpYnV0ZSgnZGF0YS10aXRsZTEnLCBgJHtwLm5hbWV9IHdlYXJpbmcgJHtpc1Zvd2VsKHBDb2xvdXJzKX0gJHtrWzBdLmJyYW5kfSBraXQke2hhc1Nwb25zb3Ioa1swXS5zcG9uc29yKX0uYCk7XG4gICAgICAgICAgICAgICAgaW1nLnNldEF0dHJpYnV0ZSgndGl0bGUnLCBgJHtwLm5hbWV9IHdlYXJpbmcgJHtpc1Zvd2VsKHBDb2xvdXJzKX0gJHtrWzBdLmJyYW5kfSBraXQke2hhc1Nwb25zb3Ioa1swXS5zcG9uc29yKX0uYCk7XG5cbiAgICAgICAgICAgICAgICAvLyBTZXQgZGl2IHRhZ3NcblxuICAgICAgICAgICAgICAgIGNUYWdzID0gcENvbG91cnMucmVwbGFjZSgnIGFuZCcsICcnKTtcbiAgICAgICAgICAgICAgICBjVGFncyA9IGNUYWdzLnJlcGxhY2UoJywnLCAnJyk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQWRkIGNvcnJlY3QgY2xhc3NlcyB0byBwbGF5ZXIgY2FyZFxuXG4gICAgICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZCgncGxheWVyJywgYGNhcmQtYmctJHtwLmNsYXNzfWAsIGB0Yy0ke3AuY2xhc3N9YCk7XG5cbiAgICAgICAgICAgIC8vIFNldCBkYXRhIGZvciBwbGF5ZXIgY2FyZFxuXG4gICAgICAgICAgICBpZiAoa1swXS5zcG9uc29yID09IGZhbHNlKSB7XG5cbiAgICAgICAgICAgICAgICBrWzBdLnNwb25zb3IgPSAnJztcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLWlkJywgcC5pZCk7XG4gICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLW5hbWUnLCBwLm5hbWUpO1xuICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1jb2xsZWN0aW9uJywgcC5jb2xsZWN0aW9uKTtcbiAgICAgICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGFncycsIGAke3AubmFtZX0gJHtwLm51bWJlcn0gJHtwLnRlYW19ICR7cC5wb3NpdGlvbn0gJHtjLnllYXJ9ICR7Yy5sb2NhdGlvbn0gJHtjLnRpdGxlfSAke3AubmF0aW9uYWxpdHl9ICR7cC50YWdzfSAke3AuY29sbGVjdGlvbn0gJHtjVGFnc30gJHtrWzBdLnNwb25zb3J9ICR7a1swXS5icmFuZH1gKTtcbiAgICAgICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgYCR7cC5uYW1lfSAke2lzQ2FwdGFpbihwLmtpdCl9ICR7cC50ZWFtfSBhcyAke2lzVm93ZWwocC5wb3NpdGlvbil9IGluIHRoZSAke2MueWVhcn0gJHtjLmxvY2F0aW9ufSAke2MudGl0bGV9LmApO1xuXG4gICAgICAgICAgICAvLyBTZXQgZGF0YSBmb3IgaW1hZ2VcblxuICAgICAgICAgICAgaW1nLnNldEF0dHJpYnV0ZSgnc3JjJywgJ2Fzc2V0cy9pbWcvYmxhbmsucG5nJyk7XG4gICAgICAgICAgICBpbWcuc2V0QXR0cmlidXRlKCdhbHQnLCBwLm5hbWUpO1xuICAgICAgICAgICAgaW1nLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGB1cmwoYXNzZXRzL2ltZy9wbGF5ZXJzLzAke3N2Z30uc3ZnKWA7XG5cbiAgICAgICAgICAgIC8vIEFkZCBwbGF5ZXIgdG8gc2VjdGlvblxuXG4gICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoaW1nKTtcbiAgICAgICAgICAgIHBsYXllcnNDb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTtcblxuICAgICAgICB9KVxuXG4gICAgfSkuY2F0Y2gocmVhc29uID0+IHtcblxuICAgICAgICBwYWdlQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2Vycm9yJyk7XG5cbiAgICB9KTtcblxuLy8gQ2xpY2tpbmcgb24gZHluYW1pYyBlbGVtZW50c1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblxuICAgIC8vIFNob3cgcGxheWVyIGluIGZ1bGwgc2NyZWVuIGRpc3BsYXlcblxuICAgIGlmIChlLnRhcmdldCAmJiBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3BsYXllcicpKSB7XG5cbiAgICAgICAgLy8gU2hvdyBkaXNwbGF5IHNlY3Rpb25cblxuICAgICAgICB0b2dnbGVEaXNwbGF5KCk7XG5cbiAgICAgICAgLy8gRmlsbCBkaXNwbGF5IHNlY3Rpb25cblxuICAgICAgICBmaWxsRGlzcGxheShlLnRhcmdldC5kYXRhc2V0LmlkKTtcblxuICAgIH1cblxuICAgIC8vIFN3aXRjaCBraXRzIHdoZW4gYXZhaWxhYmxlXG5cbiAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdraXQtc3dpdGNoJykpIHtcblxuICAgICAgICBsZXQgY3VycmVudEtpdCAgPSBkaXNwbGF5SW1hZ2Uuc3R5bGUuYmFja2dyb3VuZEltYWdlO1xuXG4gICAgICAgIGlmICghZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjdXJyZW50JykpIHtcblxuICAgICAgICAgICAgbGV0IGN1cnJlbnQgPSBkaXNwbGF5S2l0cy5xdWVyeVNlbGVjdG9yQWxsKCcuY3VycmVudCcpO1xuXG4gICAgICAgICAgICBjdXJyZW50LmZvckVhY2goYnRuID0+IHtcblxuICAgICAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdjdXJyZW50Jyk7XG5cbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2N1cnJlbnQnKTtcblxuICAgICAgICAgICAgZGlzcGxheUltYWdlLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1pbWcnKTtcbiAgICAgICAgICAgIGRpc3BsYXlJbWFnZS5zZXRBdHRyaWJ1dGUoJ3RpdGxlJyxlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGl0bGUnKSk7XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG59KTtcblxuLy8gQ29udHJvbCBwbGF5ZXIgaW4gZGlzcGxheVxuXG5kaXNwbGF5Q29udHJvbC5mb3JFYWNoKGJ1dHRvbiA9PiB7XG5cbiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG5cbiAgICAgICAgLy8gR2V0IHBsYXllciBkYXRhXG5cbiAgICAgICAgbGV0IGN1cnJlbnRQbGF5ZXIgPSBwYXJzZUludChkaXNwbGF5SW1hZ2UuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJykpO1xuXG4gICAgICAgIC8vIENsb3NlIGRpc3BsYXkgc2VjdGlvblxuXG4gICAgICAgIGlmIChidXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdjbG9zZScpKSB7XG5cbiAgICAgICAgICAgIHRvZ2dsZURpc3BsYXkoKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2hvdyBuZXh0IHBsYXllciBpbiBkaXNwbGF5IHNlY3Rpb24gaWYgYXZhaWxhYmxlXG5cbiAgICAgICAgaWYgKGJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoJ25leHQnKSkge1xuXG4gICAgICAgICAgICBsZXQgbmV4dFBsYXllciA9IGN1cnJlbnRQbGF5ZXIgKyAxO1xuXG4gICAgICAgICAgICBpZiAocGxheWVyc0NvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ3NlYXJjaGluZycpKSB7XG5cbiAgICAgICAgICAgICAgICBuZXh0UGxheWVyID0gZmluZFBsYXllcigxLG5leHRQbGF5ZXIpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnZGlzYWJsZWQnKSkge1xuXG4gICAgICAgICAgICAgICAgZmlsbERpc3BsYXkobmV4dFBsYXllcik7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2hvdyBwcmV2aW91cyBwbGF5ZXIgaW4gZGlzcGxheSBzZWN0aW9uIGlmIGF2YWlsYWJsZVxuXG4gICAgICAgIGlmIChidXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdwcmV2aW91cycpKSB7XG5cbiAgICAgICAgICAgIGxldCBwcmV2UGxheWVyID0gY3VycmVudFBsYXllciAtIDE7XG5cbiAgICAgICAgICAgIGlmIChwbGF5ZXJzQ29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygnc2VhcmNoaW5nJykpIHtcblxuICAgICAgICAgICAgICAgIHByZXZQbGF5ZXIgPSBmaW5kUGxheWVyKDIscHJldlBsYXllcik7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFidXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdkaXNhYmxlZCcpKSB7XG5cbiAgICAgICAgICAgICAgICBmaWxsRGlzcGxheShwcmV2UGxheWVyKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgIH0pO1xuXG59KTtcblxuLy8gS2V5Ym9hcmQgY29udHJvbHNcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBlID0+IHtcblxuICAgIC8vIFdoZW4gaW4gZGlzcGxheVxuXG4gICAgaWYgKGRpc3BsYXlDb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSkge1xuXG4gICAgICAgIGxldCByYW5kb21QbGF5ZXIgICAgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBwbGF5ZXJzLmxlbmd0aClcbiAgICAgICAgbGV0IGN1cnJlbnRQbGF5ZXIgICA9IHBhcnNlSW50KGRpc3BsYXlJbWFnZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKSk7XG5cbiAgICAgICAgLy8gQ2xvc2UgZGlzcGxheSBzZWN0aW9uXG5cbiAgICAgICAgaWYgKGUua2V5ID09ICdFc2NhcGUnKSB7XG5cbiAgICAgICAgICAgIHRvZ2dsZURpc3BsYXkoKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgLy8gRGlzcGxheSByYW5kb20gcGxheWVyXG5cbiAgICAgICAgaWYgKGUua2V5ID09ICdyJykge1xuXG4gICAgICAgICAgICBpZiAoIXBsYXllcnNDb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWFyY2hpbmcnKSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHJhbmRvbVBsYXllciA9PSAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgZmlsbERpc3BsYXkoMSk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIGZpbGxEaXNwbGF5KHJhbmRvbVBsYXllcik7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2hvdyBuZXh0IHBsYXllciBpbiBkaXNwbGF5IHNlY3Rpb24gaWYgYXZhaWxhYmxlXG5cbiAgICAgICAgaWYgKGUua2V5ID09ICdBcnJvd1JpZ2h0Jykge1xuXG4gICAgICAgICAgICBsZXQgbmV4dFBsYXllciA9IGN1cnJlbnRQbGF5ZXIgKyAxO1xuXG4gICAgICAgICAgICBpZiAocGxheWVyc0NvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ3NlYXJjaGluZycpKSB7XG5cbiAgICAgICAgICAgICAgICBuZXh0UGxheWVyID0gZmluZFBsYXllcigxLG5leHRQbGF5ZXIpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghZGlzcGxheUNvbnRyb2xbMV0uY2xhc3NMaXN0LmNvbnRhaW5zKCdkaXNhYmxlZCcpKSB7XG5cbiAgICAgICAgICAgICAgICBmaWxsRGlzcGxheShuZXh0UGxheWVyKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgICAgICAvLyBTaG93IHByZXZpb3VzIHBsYXllciBpbiBkaXNwbGF5IHNlY3Rpb24gaWYgYXZhaWxhYmxlXG5cbiAgICAgICAgaWYgKGUua2V5ID09ICdBcnJvd0xlZnQnKSB7XG5cbiAgICAgICAgICAgIGxldCBwcmV2UGxheWVyID0gY3VycmVudFBsYXllciAtIDE7XG5cbiAgICAgICAgICAgIGlmIChwbGF5ZXJzQ29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygnc2VhcmNoaW5nJykpIHtcblxuICAgICAgICAgICAgICAgIHByZXZQbGF5ZXIgPSBmaW5kUGxheWVyKDIscHJldlBsYXllcik7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFkaXNwbGF5Q29udHJvbFsyXS5jbGFzc0xpc3QuY29udGFpbnMoJ2Rpc2FibGVkJykpIHtcblxuICAgICAgICAgICAgICAgIGZpbGxEaXNwbGF5KHByZXZQbGF5ZXIpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgLy8gV2hlbiBvdXRzaWRlIG9mIGRpc3BsYXlcblxuICAgIGVsc2Uge1xuXG4gICAgICAgIC8vIE9wZW4gc2VhcmNoIGJhclxuXG4gICAgICAgIGlmICghc2VhcmNoQmFyLmNsYXNzTGlzdC5jb250YWlucygnc2VhcmNoaW5nJykpIHtcblxuICAgICAgICAgICAgaWYgKGUua2V5ID09ICdzJykge1xuXG4gICAgICAgICAgICAgICAgdG9nZ2xlU2VhcmNoKCk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2xvc2Ugc2VhcmNoIGJhclxuXG4gICAgICAgIGVsc2Uge1xuXG4gICAgICAgICAgICBpZiAoZS5rZXkgPT0gJ0VzY2FwZScpIHtcblxuICAgICAgICAgICAgICAgIHRvZ2dsZVNlYXJjaCgpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG59KTtcblxuLy8gSG92ZXIgb3ZlciBpbWFnZVxuXG5kaXNwbGF5QkcuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG5cbiAgICBpZiAoZGlzcGxheUJHLmNsYXNzTGlzdC5jb250YWlucygnem9vbWVkJykpIHtcblxuICAgICAgICB6b29tT3V0KCk7XG5cbiAgICB9IGVsc2Uge1xuXG4gICAgICAgIGRpc3BsYXlJbWFnZS5zdHlsZS5iYWNrZ3JvdW5kU2l6ZSA9ICc2MDAlJztcbiAgICAgICAgZGlzcGxheUJHLmNsYXNzTGlzdC5hZGQoJ3pvb21lZCcpO1xuXG4gICAgfVxuXG59KTtcblxuZGlzcGxheUJHLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGUgPT4ge1xuXG4gICAgaWYgKGRpc3BsYXlCRy5jbGFzc0xpc3QuY29udGFpbnMoJ3pvb21lZCcpKSB7XG5cbiAgICAgICAgbGV0IHggPSAtZS5vZmZzZXRYIC0gMTE1MDtcbiAgICAgICAgbGV0IHkgPSAtZS5vZmZzZXRZIC0gMTAwMDtcblxuICAgICAgICBkaXNwbGF5SW1hZ2Uuc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uID0gYCR7eH1weCAke3l9cHhgO1xuXG4gICAgfVxuXG59KTtcblxuLy8gVG9nZ2xlIHNlYXJjaCBiYXJcblxuc2VhcmNoVG9nZ2xlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuXG4gICAgdG9nZ2xlU2VhcmNoKCk7XG5cbn0pO1xuXG4vLyBQbGF5ZXIgc2VhcmNoXG5cbnNlYXJjaEJhci5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsICgpID0+IHtcblxuICAgIHNlYXJjaFBsYXllcnMoc2VhcmNoQmFyLnZhbHVlKTtcblxufSk7Il19
